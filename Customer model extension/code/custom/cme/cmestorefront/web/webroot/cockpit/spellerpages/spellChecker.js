function spellChecker(A){this.popUpUrl="fck_spellerpages/spellerpages/spellchecker.html";this.popUpName="spellchecker";this.popUpProps=null;this.replWordFlag="R";this.ignrWordFlag="I";this.replAllFlag="RA";this.ignrAllFlag="IA";this.fromReplAll="~RA";this.fromIgnrAll="~IA";this.wordFlags=new Array();this.currentTextIndex=0;this.currentWordIndex=0;this.spellCheckerWin=null;this.controlWin=null;this.wordWin=null;this.textArea=A;this.textInputs=arguments;this._spellcheck=_spellcheck;this._getSuggestions=_getSuggestions;this._setAsIgnored=_setAsIgnored;this._getTotalReplaced=_getTotalReplaced;this._setWordText=_setWordText;this._getFormInputs=_getFormInputs;this.openChecker=openChecker;this.startCheck=startCheck;this.checkTextBoxes=checkTextBoxes;this.checkTextAreas=checkTextAreas;this.spellCheckAll=spellCheckAll;this.ignoreWord=ignoreWord;this.ignoreAll=ignoreAll;this.replaceWord=replaceWord;this.replaceAll=replaceAll;this.terminateSpell=terminateSpell;this.undo=undo;window.speller=this}function checkTextBoxes(){this.textInputs=this._getFormInputs("^text$");this.openChecker()}function checkTextAreas(){this.textInputs=this._getFormInputs("^textarea$");this.openChecker()}function spellCheckAll(){this.textInputs=this._getFormInputs("^text(area)?$");this.openChecker()}function openChecker(){this.spellCheckerWin=window.open(this.popUpUrl,this.popUpName,this.popUpProps);if(!this.spellCheckerWin.opener){this.spellCheckerWin.opener=window}}function startCheck(A,C){this.wordWin=A;this.controlWin=C;this.wordWin.resetForm();this.controlWin.resetForm();this.currentTextIndex=0;this.currentWordIndex=0;this.wordFlags=new Array(this.wordWin.textInputs.length);for(var B=0;B<this.wordFlags.length;B++){this.wordFlags[B]=[]}this._spellcheck();return true}function ignoreWord(){var A=this.currentWordIndex;var B=this.currentTextIndex;if(!this.wordWin){alert("Error: Word frame not available.");return false}if(!this.wordWin.getTextVal(B,A)){alert('Error: "Not in dictionary" text is missing.');return false}if(this._setAsIgnored(B,A,this.ignrWordFlag)){this.currentWordIndex++;this._spellcheck()}return true}function ignoreAll(){var A=this.currentWordIndex;var D=this.currentTextIndex;if(!this.wordWin){alert("Error: Word frame not available.");return false}var E=this.wordWin.getTextVal(D,A);if(!E){alert('Error: "Not in dictionary" text is missing');return false}this._setAsIgnored(D,A,this.ignrAllFlag);for(var C=D;C<this.wordWin.textInputs.length;C++){for(var B=0;B<this.wordWin.totalWords(C);B++){if((C==D&&B>A)||C>D){if((this.wordWin.getTextVal(C,B)==E)&&(!this.wordFlags[C][B])){this._setAsIgnored(C,B,this.fromIgnrAll)}}}}this.currentWordIndex++;this._spellcheck();return true}function replaceWord(){var B=this.currentWordIndex;var C=this.currentTextIndex;if(!this.wordWin){alert("Error: Word frame not available.");return false}if(!this.wordWin.getTextVal(C,B)){alert('Error: "Not in dictionary" text is missing');return false}if(!this.controlWin.replacementText){return false}var A=this.controlWin.replacementText;if(A.value){var D=new String(A.value);if(this._setWordText(C,B,D,this.replWordFlag)){this.currentWordIndex++;this._spellcheck()}}return true}function replaceAll(){var E=this.currentTextIndex;var B=this.currentWordIndex;if(!this.wordWin){alert("Error: Word frame not available.");return false}var G=this.wordWin.getTextVal(E,B);if(!G){alert('Error: "Not in dictionary" text is missing');return false}var A=this.controlWin.replacementText;if(!A.value){return false}var F=new String(A.value);this._setWordText(E,B,F,this.replAllFlag);for(var D=E;D<this.wordWin.textInputs.length;D++){for(var C=0;C<this.wordWin.totalWords(D);C++){if((D==E&&C>B)||D>E){if((this.wordWin.getTextVal(D,C)==G)&&(!this.wordFlags[D][C])){this._setWordText(D,C,F,this.fromReplAll)}}}}this.currentWordIndex++;this._spellcheck();return true}function terminateSpell(){var C="";var A=this._getTotalReplaced();if(A==0){if(!this.wordWin){C=""}else{if(this.wordWin.totalMisspellings()){C+=FCKLang.DlgSpellNoChanges}else{C+=FCKLang.DlgSpellNoMispell}}}else{if(A==1){C+=FCKLang.DlgSpellOneChange}else{C+=FCKLang.DlgSpellManyChanges.replace(/%1/g,A)}}if(C){alert(C)}if(A>0){for(var B=0;B<this.textInputs.length;B++){if(this.wordWin){if(this.wordWin.textInputs[B]){this.textInputs[B].value=this.wordWin.textInputs[B]}}}}if(typeof (this.OnFinished)=="function"){this.OnFinished(A)}return true}function undo(){var F=this.currentTextIndex;var B=this.currentWordIndex;if(this.wordWin.totalPreviousWords(F,B)>0){this.wordWin.removeFocus(F,B);do{if(this.currentWordIndex==0&&this.currentTextIndex>0){this.currentTextIndex--;this.currentWordIndex=this.wordWin.totalWords(this.currentTextIndex)-1;if(this.currentWordIndex<0){this.currentWordIndex=0}}else{if(this.currentWordIndex>0){this.currentWordIndex--}}}while(this.wordWin.totalWords(this.currentTextIndex)==0||this.wordFlags[this.currentTextIndex][this.currentWordIndex]==this.fromIgnrAll||this.wordFlags[this.currentTextIndex][this.currentWordIndex]==this.fromReplAll);var H=this.currentTextIndex;var A=this.currentWordIndex;var C=this.wordWin.originalSpellings[H][A];if(this.wordWin.totalPreviousWords(H,A)==0){this.controlWin.disableUndo()}var E,D,G;switch(this.wordFlags[H][A]){case this.replAllFlag:for(E=H;E<this.wordWin.textInputs.length;E++){for(D=0;D<this.wordWin.totalWords(E);D++){if((E==H&&D>=A)||E>H){G=this.wordWin.originalSpellings[E][D];if(G==C){this._setWordText(E,D,G,undefined)}}}}break;case this.ignrAllFlag:for(E=H;E<this.wordWin.textInputs.length;E++){for(D=0;D<this.wordWin.totalWords(E);D++){if((E==H&&D>=A)||E>H){G=this.wordWin.originalSpellings[E][D];if(G==C){this.wordFlags[E][D]=undefined}}}}break;case this.replWordFlag:this._setWordText(H,A,C,undefined);break}this.wordFlags[H][A]=undefined;this._spellcheck()}}function _spellcheck(){var B=this.wordWin;if(this.currentWordIndex==B.totalWords(this.currentTextIndex)){this.currentTextIndex++;this.currentWordIndex=0;if(this.currentTextIndex<this.wordWin.textInputs.length){this._spellcheck();return }else{this.terminateSpell();return }}if(this.currentWordIndex>0){this.controlWin.enableUndo()}if(this.wordFlags[this.currentTextIndex][this.currentWordIndex]){this.currentWordIndex++;this._spellcheck()}else{var A=B.getTextVal(this.currentTextIndex,this.currentWordIndex);if(A){this.controlWin.evaluatedText.value=A;B.setFocus(this.currentTextIndex,this.currentWordIndex);this._getSuggestions(this.currentTextIndex,this.currentWordIndex)}}}function _getSuggestions(D,A){this.controlWin.clearSuggestions();var C=this.wordWin.suggestions[D][A];if(C){for(var B=0;B<C.length;B++){this.controlWin.addSuggestion(C[B])}}this.controlWin.selectDefaultSuggestion()}function _setAsIgnored(C,B,A){this.wordWin.removeFocus(C,B);this.wordFlags[C][B]=A;return true}function _getTotalReplaced(){var C=0;for(var B=0;B<this.wordFlags.length;B++){for(var A=0;A<this.wordFlags[B].length;A++){if((this.wordFlags[B][A]==this.replWordFlag)||(this.wordFlags[B][A]==this.replAllFlag)||(this.wordFlags[B][A]==this.fromReplAll)){C++}}}return C}function _setWordText(D,B,C,A){this.wordWin.setText(D,B,C);this.wordFlags[D][B]=A;return true}function _getFormInputs(B){var A=new Array();for(var D=0;D<document.forms.length;D++){for(var C=0;C<document.forms[D].elements.length;C++){if(document.forms[D].elements[C].type.match(B)){A[A.length]=document.forms[D].elements[C]}}}return A};